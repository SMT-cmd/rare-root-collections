<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RARE ROOT | Prestige</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <style>
/* -------------------------------------------------------
   THEME: PRESTIGE STREETWEAR (Wine, Gold, Dark)
   ------------------------------------------------------- */
:root {
    --bg-dark: #2b1f1a;
    --bg-wine: #3a2a22;
    --bg-card: rgba(255, 255, 255, 0.05);
    --text-gold: #d8a35d;
    --text-cream: #efe6d9;
    --accent-red: #b23a3a;
    --glass: rgba(58, 42, 34, 0.7);
    --glass-border: rgba(255, 255, 255, 0.1);
    --font-head: 'Cinzel', serif;
    --font-body: 'Inter', sans-serif;
}

.glass-card {
    background: var(--bg-card);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

.glass-drawer {
    background: rgba(42, 32, 26, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-left: 1px solid var(--glass-border);
}

html {
    scroll-behavior: smooth;
}

body {
    margin: 0;
    padding: 0;
    font-family: var(--font-body);
    background-color: var(--bg-dark);
    background-image:
        radial-gradient(1200px 800px at 20% 10%, rgba(216, 163, 93, 0.08), transparent 70%),
        radial-gradient(900px 600px at 80% 30%, rgba(216, 163, 93, 0.06), transparent 70%),
        url("https://www.transparenttextures.com/patterns/white-linen.png");
    background-blend-mode: normal, normal, multiply;
    background-size: auto, auto, 300px 300px;
    color: var(--text-cream);
    overflow-x: hidden;
    line-height: 1.6;
}

/* -------------------------------------------------------
   ANIMATIONS
   ------------------------------------------------------- */
.reveal-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
}

.reveal-on-scroll.visible {
    opacity: 1;
    transform: translateY(0);
}

@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
    100% { transform: translateY(0px); }
}

/* -------------------------------------------------------
   HEADER & MENU (MODERN GLASS)
   ------------------------------------------------------- */
nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 40px;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    background: rgba(58, 42, 34, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
}

.menu-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    width: 45px;
    height: 45px;
    border-radius: 12px;
    font-size: 1.2rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.menu-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #ffc107;
}

.logo {
    display: block;
    text-align: center;
}

.nav-logo-img {
    height: 80px;
    width: auto;
    display: block;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.nav-logo-img:hover {
    transform: scale(1.05);
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

.cart-icon {
    position: relative;
    background: rgba(255, 255, 255, 0.05);
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.cart-icon:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-2px);
}

.cart-icon i {
    font-size: 1.2rem;
    color: var(--text-gold);
}

.cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #ff4757;
    color: white;
    font-size: 0.7rem;
    font-weight: 800;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    border: 2px solid #0a0e14;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

/* -------------------------------------------------------
   HERO SECTION (PREMIUM)
   ------------------------------------------------------- */
.hero {
    position: relative;
    text-align: center;
    padding: 160px 20px 100px;
    background: radial-gradient(circle at center, rgba(108, 76, 55, 0.45) 0%, var(--bg-dark) 70%);
    overflow: hidden;
}

.hero::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e0c097' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 1;
    z-index: -1;
}

.hero-title {
    font-family: var(--font-head);
    font-size: 3.5rem; /* Reduced from 5rem */
    color: var(--text-gold);
    margin: 0 0 20px;
    line-height: 1.1;
    text-transform: uppercase;
    letter-spacing: 2px; /* More breathable */
    text-shadow: 0 10px 30px rgba(0,0,0,0.5);
    opacity: 0; /* Animated by JS */
    animation: fadeInUp 1s forwards 0.2s;
}

.hero-subtitle {
    font-size: 1rem;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--text-cream);
    opacity: 0;
    font-weight: 300;
    margin-bottom: 40px;
    animation: fadeInUp 1s forwards 0.5s;
}

.btn-hero {
    background: transparent;
    border: 1px solid var(--text-gold);
    color: var(--text-gold);
    padding: 15px 40px;
    font-family: var(--font-body);
    font-size: 0.85rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    opacity: 0;
    animation: fadeInUp 1s forwards 0.8s;
}

.btn-hero:hover {
    background: var(--text-gold);
    color: var(--bg-dark);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(224, 192, 151, 0.1);
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
}

/* -------------------------------------------------------
   BRAND IDENTITY
   ------------------------------------------------------- */
.brand-identity {
    padding: 80px 20px;
    text-align: center;
    max-width: 900px;
    margin: 0 auto;
    position: relative;
}

.brand-text {
    font-size: 1.25rem;
    line-height: 1.8;
    color: var(--text-cream);
    opacity: 0.9;
    font-weight: 300;
}

.brand-text strong {
    color: var(--text-gold);
    font-weight: 600;
}

/* -------------------------------------------------------
   LAYOUT & GRID
   ------------------------------------------------------- */
.container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
}

.collection-header {
    margin: 80px 0 40px;
    text-align: center;
    position: relative;
}

.collection-header::after {
    content: '';
    display: block;
    width: 40px;
    height: 1px;
    background: var(--text-gold);
    margin: 15px auto 0;
    opacity: 0.5;
}

.category-title {
    font-family: var(--font-head);
    font-size: 2.2rem; /* Smaller, more elegant */
    color: var(--text-gold);
    margin: 0;
    letter-spacing: 2px;
    font-weight: 400;
}

.category-subtitle {
    font-family: var(--font-body);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    opacity: 0.6;
    margin-top: 8px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
    margin-bottom: 80px;
}

/* -------------------------------------------------------
   PRODUCT CARDS (GLASSMORPHISM)
   ------------------------------------------------------- */
.product-card {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    position: relative;
    padding: 12px;
}

.product-card:hover {
    transform: translateY(-8px);
    border-color: var(--text-gold);
    background: rgba(255, 255, 255, 0.06);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
}

.product-image-container {
    width: 100%;
    aspect-ratio: 1/1;
    height: auto;
    overflow: hidden;
    position: relative;
    background: #33251f;
    border-radius: 12px;
    margin-bottom: 12px;
}

.product-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
}

.product-card:hover .product-image-container img {
    transform: scale(1.05);
}

.discount-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #ff4757;
    color: white;
    padding: 4px 8px;
    font-size: 0.65rem;
    font-weight: 800;
    border-radius: 6px;
    z-index: 2;
}

.product-info {
    padding: 4px 2px;
}

.product-info h3 {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: #fff;
    margin: 0 0 6px 0;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.product-info .price {
    font-size: 1.1rem;
    color: var(--text-gold);
    font-weight: 800;
    font-family: var(--font-body);
    margin: 0;
}

.product-info .original-price {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.3);
    text-decoration: line-through;
    margin-right: 8px;
}

/* Add to Cart Button on Card (matches screenshot) */
.view-options-btn {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: var(--text-gold);
    color: #000;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.product-card:hover .view-options-btn {
    opacity: 1;
    transform: translateY(0);
}

.view-options-btn i {
    font-size: 0.9rem;
}

/* -------------------------------------------------------
   NEWSLETTER
   ------------------------------------------------------- */
.newsletter-section {
    background: linear-gradient(to bottom, var(--bg-dark), #110a09);
    padding: 120px 20px;
    text-align: center;
    border-top: 1px solid rgba(224, 192, 151, 0.05);
}

.newsletter-content h3 {
    font-family: var(--font-head);
    font-size: 2.5rem;
    color: var(--text-gold);
    margin-bottom: 15px;
}

.newsletter-content p {
    color: rgba(244, 241, 234, 0.6);
    margin-bottom: 40px;
}

.newsletter-form {
    display: flex;
    justify-content: center;
    gap: 0;
    max-width: 500px;
    margin: 0 auto;
    position: relative;
}

.newsletter-form input {
    padding: 18px 25px;
    width: 100%;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-cream);
    font-family: var(--font-body);
    font-size: 1rem;
    border-radius: 4px 0 0 4px;
    transition: border-color 0.3s;
}

.newsletter-form input:focus {
    outline: none;
    border-color: var(--text-gold);
}

.newsletter-form button {
    padding: 18px 30px;
    background: var(--text-gold);
    border: none;
    color: var(--bg-dark);
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
    border-radius: 0 4px 4px 0;
    transition: background 0.3s;
}

.newsletter-form button:hover {
    background: #fff;
}

/* -------------------------------------------------------
   FOOTER
   ------------------------------------------------------- */
footer {
    background: #110a09;
    padding: 100px 40px 30px;
    border-top: 1px solid rgba(224, 192, 151, 0.1);
}

.footer-content {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 60px;
    max-width: 1600px;
    margin: 0 auto;
}

.footer-logo {
    height: 80px; /* Bigger footer logo */
    margin-bottom: 20px;
    opacity: 0.9;
}

.footer-col h4 {
    font-family: var(--font-head);
    color: var(--text-gold);
    margin-bottom: 25px;
    font-size: 1.1rem;
}

.footer-col a {
    display: block;
    color: rgba(244, 241, 234, 0.6);
    text-decoration: none;
    margin-bottom: 15px;
    font-size: 0.9rem;
    transition: color 0.3s, transform 0.3s;
}

.footer-col a:hover {
    color: var(--text-gold);
    transform: translateX(5px);
}

.footer-bottom {
    text-align: center;
    margin-top: 80px;
    padding-top: 30px;
    border-top: 1px solid rgba(255,255,255,0.03);
    font-size: 0.8rem;
    color: rgba(255,255,255,0.3);
}

/* -------------------------------------------------------
   DRAWER SYSTEM (Menu & Cart)
   ------------------------------------------------------- */
.menu-drawer, .cart-drawer {
    position: fixed;
    top: 0;
    height: 100vh;
    background: rgba(42, 32, 26, 0.92);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    z-index: 1000;
    transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
    box-shadow: 0 0 50px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--glass-border);
}

.menu-drawer {
    left: 0;
    width: 320px;
    max-width: 75vw;
    transform: translateX(-100%);
    border-right: 1px solid var(--glass-border);
}

.cart-drawer {
    right: 0;
    width: 380px;
    max-width: 85vw;
    transform: translateX(100%);
    border-left: 1px solid var(--glass-border);
    border-right: none;
}

.menu-drawer.open, .cart-drawer.open {
    transform: translateX(0);
}

.menu-header, .cart-header {
    padding: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.menu-title, .cart-title {
    font-family: var(--font-head);
    font-size: 1.5rem;
    color: var(--text-gold);
}
.cart-title img {
    height: 28px;
    filter: drop-shadow(0 0 8px rgba(224, 192, 151, 0.2));
}

.close-menu, .close-cart {
    background: none;
    border: none;
    color: var(--text-cream);
    font-size: 2rem;
    cursor: pointer;
    line-height: 1;
    transition: color 0.3s;
}

.close-menu:hover, .close-cart:hover {
    color: var(--text-gold);
}

.menu-links {
    list-style: none;
    padding: 40px 30px;
    margin: 0;
}

.menu-links li {
    margin-bottom: 25px;
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.4s ease;
}

.menu-drawer.open .menu-links li {
    opacity: 1;
    transform: translateX(0);
}

/* Stagger animations for menu items */
.menu-drawer.open .menu-links li:nth-child(1) { transition-delay: 0.1s; }
.menu-drawer.open .menu-links li:nth-child(2) { transition-delay: 0.2s; }
.menu-drawer.open .menu-links li:nth-child(3) { transition-delay: 0.3s; }
.menu-drawer.open .menu-links li:nth-child(4) { transition-delay: 0.4s; }
.menu-drawer.open .menu-links li:nth-child(5) { transition-delay: 0.5s; }

.menu-links a {
    color: var(--text-cream);
    text-decoration: none;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: color 0.3s, padding-left 0.3s;
    display: block;
}

.menu-links a:hover {
    color: var(--text-gold);
    padding-left: 10px;
}

.cart-items {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}
.empty-cart {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    border: 1px solid var(--glass-border);
}
.empty-cart img {
    height: 90px;
    margin-bottom: 16px;
    opacity: 0.9;
}

.cart-item {
    display: flex;
    gap: 15px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    margin-bottom: 15px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.cart-item:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.2);
}

.cart-item-img {
    width: 80px;
    height: 80px;
    border-radius: 12px;
    object-fit: cover;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.cart-item-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.cart-item-name {
    font-family: var(--font-body);
    font-size: 0.9rem;
    color: #fff;
    margin-bottom: 5px;
    font-weight: 600;
    text-transform: uppercase;
}

.cart-item-price {
    font-size: 1rem;
    color: #ffc107;
    font-weight: 800;
    margin-bottom: 8px;
}

.cart-item-controls {
    display: flex;
    align-items: center;
    gap: 12px;
}

.qty-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    width: 28px;
    height: 28px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    transition: all 0.2s;
}

.qty-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.remove-item {
    color: #ff4757;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 0.8rem;
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 5px;
    opacity: 0.7;
    transition: opacity 0.2s;
}

.remove-item:hover {
    opacity: 1;
}

.cart-footer {
    padding: 30px;
    background: rgba(10, 14, 20, 0.9);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-checkout {
    width: 100%;
    padding: 18px;
    background: var(--text-gold);
    color: #000;
    border: none;
    border-radius: 12px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 0.9rem;
}

.btn-checkout:hover {
    background: #fff;
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
}
.checkout-email {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 18px;
}
.checkout-email input {
    width: 100%;
    padding: 12px 14px;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(224, 192, 151, 0.2);
    border-radius: 12px;
    color: var(--text-cream);
    font-family: var(--font-body);
    font-size: 0.9rem;
    outline: none;
}
.checkout-email input::placeholder {
    color: rgba(244, 241, 234, 0.6);
}

.total-price {
    display: flex;
    justify-content: space-between;
    font-family: var(--font-body);
    color: #fff;
    font-size: 1.1rem;
    margin-bottom: 25px;
    font-weight: 500;
}

.total-price span:last-child {
    color: #fff;
    font-weight: 800;
    font-size: 1.4rem;
}

.overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(3px);
    z-index: 900;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s;
}

.overlay.active {
    opacity: 1;
    pointer-events: all;
}

/* -------------------------------------------------------
   DRAWER & MODAL UI UPDATES (OVERRIDES)
   ------------------------------------------------------- */
.menu-drawer, .cart-drawer {
    /* Kept for specificity if needed, but main styles are above */
    border-color: rgba(224, 192, 151, 0.1);
}

.search-box input {
    width: 190px;
    padding: 8px 12px;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(224, 192, 151, 0.2);
    border-radius: 4px;
    color: var(--text-cream);
    font-family: var(--font-body);
    font-size: 0.85rem;
}

.search-box input::placeholder {
    color: rgba(244, 241, 234, 0.5);
}

/* Toast */
.toast {
    background-color: var(--text-gold);
    color: var(--bg-dark);
    font-family: var(--font-body);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

/* Modal Glass Styling */
.modal {
    display: none; 
    position: fixed; 
    z-index: 2000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.8); 
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
}

.modal-content {
    background: var(--bg-card);
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    margin: 40px auto; 
    width: 95%; 
    max-width: 1000px;
    display: flex;
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    box-shadow: 0 40px 100px rgba(0,0,0,0.6);
    position: relative;
    animation: modalReveal 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    overflow: hidden;
}

@keyframes modalReveal {
    from { opacity: 0; transform: translateY(30px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.close-modal {
    position: absolute;
    top: 20px;
    right: 25px;
    color: var(--text-gold);
    font-size: 2.2rem;
    cursor: pointer;
    z-index: 100;
    line-height: 1;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.close-modal:hover {
    background: var(--text-gold);
    color: var(--bg-dark);
}

.modal-body {
    display: flex;
    width: 100%;
}

@media (max-width: 900px) {
    .modal-body { flex-direction: column; }
    .modal-content { margin: 0; width: 100%; height: 100vh; border-radius: 0; overflow-y: auto; }
}

.modal-left {
    flex: 1.2;
    background: rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    padding: 20px;
}

.modal-img-container {
    position: relative;
    width: 100%;
    height: 500px;
    margin-bottom: 20px;
    border-radius: 16px;
    overflow: hidden;
    background: #000;
}

.modal-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.5s ease;
}

.modal-thumbnails {
    display: flex;
    gap: 12px;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
}

.modal-thumbnails::-webkit-scrollbar { display: none; }

.thumb-img {
    width: 70px;
    height: 70px;
    border-radius: 12px;
    object-fit: cover;
    border: 2px solid transparent;
    cursor: pointer;
    opacity: 0.5;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.thumb-img.active {
    opacity: 1;
    border-color: var(--text-gold);
    transform: scale(1.05);
}

.modal-info {
    flex: 1;
    padding: 50px 40px;
    display: flex;
    flex-direction: column;
    background: rgba(255, 255, 255, 0.02);
}

.modal-info h2 {
    font-family: var(--font-head);
    font-size: 2.2rem;
    color: var(--text-gold);
    margin-bottom: 10px;
    letter-spacing: 1px;
}

.modal-price {
    font-size: 1.8rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 30px;
}

.modal-description {
    font-size: 1rem;
    line-height: 1.8;
    color: rgba(255,255,255,0.7);
    margin-bottom: 40px;
    border-bottom: 1px solid var(--glass-border);
    padding-bottom: 30px;
}

.modal-opt-group {
    margin-bottom: 25px;
}

.modal-opt-label {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-gold);
    margin-bottom: 12px;
    opacity: 0.8;
}

.modal-select {
    width: 100%;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--glass-border);
    color: var(--text-cream);
    font-family: var(--font-body);
    font-size: 0.95rem;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.modal-select:focus {
    outline: none;
    border-color: var(--text-gold);
    background: rgba(255, 255, 255, 0.1);
}

.btn-add-modal {
    width: 100%;
    padding: 20px;
    background: var(--text-gold);
    color: #000;
    border: none;
    border-radius: 16px;
    font-size: 0.95rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 20px;
}

.btn-add-modal:hover {
    background: #fff;
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.4);
}

/* Hide the old btn-checkout class inside modal */
.modal-info .btn-checkout { display: none; }

/* Responsive Modal */
@media (max-width: 900px) {
    .modal-content {
        margin: 0;
        width: 100%;
        height: 100%;
        max-width: none;
        flex-direction: column;
        overflow-y: auto;
    }
    
    .modal-body {
        flex-direction: column;
    }

    .modal-left {
        height: 50vh;
        padding: 0;
    }

    .modal-img {
        height: 100%;
    }

    .modal-info {
        padding: 30px 20px;
    }
    
    .close-modal {
        top: 10px;
        right: 15px;
        background: rgba(0,0,0,0.5);
        width: 40px;
        height: 40px;
        text-align: center;
        border-radius: 50%;
    }
}

/* Responsive Global */
@media (max-width: 900px) {
    nav { padding: 14px 18px; }
    .hero-title { font-size: 3rem; }
    .grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 14px; }
    .footer-content { grid-template-columns: 1fr; text-align: center; gap: 40px; }
    .nav-logo-img { height: 72px; }
    .nav-actions { gap: 12px; }
    .menu-btn { font-size: 1.6rem; }
    .add-to-cart-btn { opacity: 1; transform: translateY(0); }
    .product-info h3 { font-size: 0.85rem; }
    .product-info .price { font-size: 0.9rem; }
    .search-box { display: none; }
}

@media (max-width: 600px) {
    nav { padding: 12px 14px; }
    .hero { padding: 110px 16px; }
    .hero-title { font-size: 2.5rem; }
    .collection-header { margin: 70px 0 30px; }
    .nav-actions { gap: 10px; }
    .nav-logo-img { height: 60px; }
    .grid { grid-template-columns: repeat(2, minmax(140px, 1fr)); gap: 12px; }
    .product-info { padding: 10px 0; }
    .product-info h3 { font-size: 0.82rem; }
    .product-info .price { font-size: 0.85rem; }
    .menu-drawer, .cart-drawer { width: 100%; max-width: 100%; }
    .menu-links a { font-size: 1rem; }
    .cart-drawer { width: 100%; }
    .modal-left { height: 45vh; }
    .modal-img { height: 45vh; }
}
    </style>
    <!-- Favicon -->
    <link rel="icon" href="https://files.fm/thumb.php?i=y628qspy4s" type="image/jpeg">
    
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <!-- Removed Netlify Identity Script -->
</head>
<body>

    <nav>
        <button class="menu-btn" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </button>
        <a href="#" class="logo">
            <img src="https://files.fm/thumb.php?i=4wunrd26s5" alt="RARE ROOT" class="nav-logo-img">
        </a>
        <div class="nav-actions">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search products..." onkeyup="handleSearch(this.value)">
            </div>
            <div class="cart-icon" onclick="toggleCart()">
                <i class="fas fa-shopping-cart"></i>
                <span id="cart-count" class="cart-count">0</span>
            </div>
        </div>
    </nav>

    <header class="hero">
        <h1 class="hero-title">RARE ROOT</h1>
        <p class="hero-subtitle">Prestige in Every Thread</p>
        <button class="btn-hero" onclick="document.getElementById('exchange-grid').scrollIntoView({behavior: 'smooth'})">Explore the Collection</button>
    </header>

    <!-- Brand Identity Section -->
    <section class="brand-identity" style="padding: 60px 20px; text-align: center; max-width: 800px; margin: 0 auto;">
        <p style="font-size: 1.1rem; line-height: 1.8; color: var(--text-cream); opacity: 0.9;">
            <strong style="color: var(--text-gold);">RARE ROOT</strong> is a premium streetwear collective designed for the disciplined. 
            Rooted in Nigeria and serving the global hustle, we provide the high-performance uniform for those who move in silence. 
            Analyzing charts during a late-night trading session or pushing past your limits at the gym, our apparel represents your dedication to the grind.
        </p>
    </section>

    <div class="container">
        <!-- SEARCH BAR -->
        <div class="search-container"></div>

    <div class="collection-header">
        <h2 class="category-title">THE EXCHANGE</h2>
        <p class="category-subtitle">Calculated Moves. Legacy Built.</p>
    </div>
    <div class="grid" id="exchange-grid"></div>

    <div class="collection-header">
        <h2 class="category-title">KINETIC</h2>
        <p class="category-subtitle">Form Meets Function. The Street Performance Line.</p>
    </div>
    <div class="grid" id="kinetic-grid"></div>

    <div class="collection-header">
        <h2 class="category-title">URBAN ARCHIVE</h2>
        <p class="category-subtitle">The Signature Street Silhouettes.</p>
    </div>
    <div class="grid" id="urban-grid"></div>

    </div>

    <!-- Newsletter Section -->
    <div class="newsletter-section">
        <div class="newsletter-content">
            <h3>Join The Inner Circle</h3>
            <p>Exclusive drops, early access, and insider trading.</p>
            <form class="newsletter-form" onsubmit="event.preventDefault(); alert('Welcome to the inner circle.');">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">Subscribe</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div class="footer-content">
            <div class="footer-col brand-col">
                <img src="https://files.fm/thumb.php?i=y628qspy4s" alt="RARE ROOT" class="footer-logo">
                <p>Prestige in every thread.</p>
            </div>
            <div class="footer-col">
                <h4>Shop</h4>
                <a href="#exchange-grid">The Exchange</a>
                <a href="#kinetic-grid">Kinetic</a>
                <a href="#urban-grid">Urban Archive</a>
            </div>
            <div class="footer-col">
                <h4>Support</h4>
                <a href="#">Shipping & Returns</a>
                <a href="#">Size Guide</a>
                <a href="#footer">Contact Us</a>
                <a href="admin" style="opacity: 0.5; font-size: 0.8rem;">Admin Access</a>
            </div>
            <div class="footer-col">
                <h4>Stay Connected</h4>
                <div class="social-links">
                    <a href="#">Instagram</a>
                    <a href="#">Twitter</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 RARE ROOT. All rights reserved.</p>
        </div>
    </footer>

    <div class="overlay" id="overlay" onclick="closeAllDrawers()"></div>

    <!-- Mobile Menu Drawer -->
    <div class="menu-drawer" id="menu-drawer">
        <div class="menu-header">
            <span class="menu-title">Menu</span>
            <button class="close-menu" onclick="toggleMenu()">×</button>
        </div>
        <ul class="menu-links">
            <li><a href="#" onclick="toggleMenu()">Home</a></li>
            <li><a href="#exchange-grid" onclick="toggleMenu()">The Exchange</a></li>
            <li><a href="#kinetic-grid" onclick="toggleMenu()">Kinetic</a></li>
            <li><a href="#urban-grid" onclick="toggleMenu()">Urban Archive</a></li>
            <li><a href="#footer" onclick="toggleMenu()">Contact</a></li>
        </ul>
    </div>

    <div class="cart-drawer" id="cart-drawer">
        <div class="cart-header">
            <span class="cart-title"><img src="https://files.fm/thumb.php?i=4wunrd26s5" alt="RARE ROOT"></span>
            <button class="close-cart" onclick="toggleCart()">×</button>
        </div>
        <div class="cart-items" id="cart-items">
            <!-- Items injected by JS -->
        </div>
        <div class="cart-footer">
            <div class="total-price">
                <span>Total</span>
                <span id="cart-total">₦0</span>
            </div>
            <div class="checkout-email">
                <input type="email" id="checkout-email" placeholder="Email for receipt">
            </div>
            <button class="btn-checkout" onclick="checkoutPaystack()">
                <i class="fas fa-credit-card"></i> SECURE CHECKOUT
            </button>
        </div>
    </div>

    <div id="toast" class="toast">Notification</div>

    <!-- Prestige Loader -->
    <div id="prestige-loader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-dark); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; transition: opacity 0.8s ease;">
        <img src="https://files.fm/thumb.php?i=y628qspy4s" alt="RARE ROOT" style="height:100px; margin-bottom:20px; filter:drop-shadow(0 0 10px rgba(224, 192, 151, 0.2));">
        <div style="width:40px; height:1px; background:var(--text-gold); animation: pulse 1.5s infinite;"></div>
    </div>

    <style>
        @keyframes pulse {
            0% { width: 0; opacity: 0; }
            50% { width: 40px; opacity: 1; }
            100% { width: 0; opacity: 0; }
        }
    </style>

    <!-- Product Details Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-body" id="modal-body">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Script removed for GitHub Pages compatibility -->
    <script>
// ------------------------------------------------
// 1. DATABASE & STATE
// ------------------------------------------------
let products = [];
let cart = [];
let currentModalProduct = null;
let db;
const PAYSTACK_PUBLIC_KEY = 'pk_test_74a74bdf05a89708936bc958ca3ddadf8ab3b3ef'; 

// Firebase Configuration (Replace with your actual keys from Firebase Console)
const FIREBASE_CONFIG = { 
    apiKey: "AIzaSyDUemRdj8Q65vuid8ePqliNdrUmCBQjAiQ", 
    authDomain: "rare-root.firebaseapp.com", 
    projectId: "rare-root", 
    storageBucket: "rare-root.firebasestorage.app", 
    messagingSenderId: "555337627727", 
    appId: "1:555337627727:web:1e642ad1cbb5f2d6b7523a", 
    measurementId: "G-4QG0W6KZMN" 
};

function initFirebase() {
    if (!firebase.apps.length) {
        firebase.initializeApp(FIREBASE_CONFIG);
        if (typeof firebase.analytics === 'function') {
            firebase.analytics();
        }
    }
    db = firebase.firestore();
}

// Fetch Products from Firebase Firestore
async function fetchProducts() {
    try {
        initFirebase();
        
        const snapshot = await db.collection('products').get();
        products = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));

        console.log('Loaded products from Firebase:', products.length);
        initializeShop();
        hideLoader();
    } catch (error) {
        console.error('Error loading products from Firebase:', error);
        
        // Fallback to local JSON if Firebase fails (for development/first run)
        try {
            const response = await fetch('data/products.json');
            const data = await response.json();
            products = data.products || [];
            initializeShop();
            hideLoader();
        } catch (e) {
            showToast('Error loading shop inventory.');
            hideLoader();
        }
    }
}

function hideLoader() {
    const loader = document.getElementById('prestige-loader');
    if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => loader.style.display = 'none', 800);
    }
}



function initializeShop() {
    // Render all categories
    const categories = [...new Set(products.map(p => p.category))];
    
    // Clear existing grids first (in case of re-init)
    document.querySelectorAll('.grid').forEach(grid => grid.innerHTML = '');

    // 1. Render explicitly defined sections in HTML
    renderCategory("The Exchange", "exchange-grid");
    renderCategory("Kinetic", "kinetic-grid");
    renderCategory("Urban Archive", "urban-grid");
    
    // 2. Future proof: If we have new categories from Firebase that don't have a specific grid, 
    // we could dynamically create them here. For now, we stick to the prestige layout.
    // To show ALL products regardless of category if the user adds new ones:
    const definedCategories = ["The Exchange", "Kinetic", "Urban Archive"];
    const otherCategories = categories.filter(c => !definedCategories.includes(c));
    
    if (otherCategories.length > 0) {
        console.log("New categories found in database:", otherCategories);
        // We could append them to the bottom of the page if needed
    }
}

// ------------------------------------------------
// 2. RENDERING
// ------------------------------------------------
function renderCategory(categoryName, elementId) {
    const container = document.getElementById(elementId);
    if (!container) return; 
    
    // Filter by category and ensure not hidden
    // Normalize string comparison to avoid case/space issues
    const items = products.filter(p => p.category.trim() === categoryName.trim() && !p.hidden);
    
    if (items.length === 0) {
        // Optional: Hide section if empty
        // container.previousElementSibling.style.display = 'none';
        container.innerHTML = '<p style="grid-column: 1/-1; text-align:center; opacity:0.5;">Coming Soon</p>';
        return;
    }

    container.innerHTML = ''; // Clear current content
    
    items.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.onclick = () => openProductModal(product.id);
        
        const isSale = product.sale_price && product.sale_price < product.price;
        const priceDisplay = isSale 
            ? `<span class="original-price">₦${product.price.toLocaleString()}</span> <span class="price">₦${product.sale_price.toLocaleString()}</span>` 
            : `<span class="price">₦${product.price.toLocaleString()}</span>`;
        
        const discountBadge = isSale 
            ? `<span class="discount-badge">-${Math.round(((product.price - product.sale_price) / product.price) * 100)}%</span>` 
            : '';

        card.innerHTML = `
            <div class="product-image-container">
                ${discountBadge}
                <img src="${product.img}" alt="${product.name}" loading="lazy">
                <button class="view-options-btn">
                    <i class="fas fa-shopping-cart"></i> VIEW OPTIONS
                </button>
            </div>
            <div class="product-info">
                <h3>${product.name}</h3>
                ${priceDisplay}
            </div>
        `;
        container.appendChild(card);
    });
}

// ------------------------------------------------
// 3. PRODUCT MODAL & SELECTION
// ------------------------------------------------
function openProductModal(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;

    currentModalProduct = product;
    const modal = document.getElementById('product-modal');
    const modalBody = document.getElementById('modal-body');

    // Price Logic
    let priceDisplay = `₦${product.price.toLocaleString()}`;
    let actualPrice = product.price;
    if (product.sale_price) {
        priceDisplay = `<span class="original-price" style="font-size: 1rem; color: rgba(255,255,255,0.4);">₦${product.price.toLocaleString()}</span> ₦${product.sale_price.toLocaleString()}`;
        actualPrice = product.sale_price;
    }

    // Generate Size Options
    let sizeOptions = product.sizes ? product.sizes.map(s => `<option value="${s}">${s}</option>`).join('') : '<option>One Size</option>';
    
    // Generate Color/Variant Logic
    let variants = product.variants || [];
    
    // Fallback for legacy products
    if (variants.length === 0 && product.colors) {
        variants = product.colors.map(c => ({
            color: c.color,
            image: product.img // Use main image as fallback
        }));
    }
    // If still no variants, create a dummy one
    if (variants.length === 0) {
        variants = [{color: 'Standard', image: product.img}];
    }

    // Generate Options
    const colorOptions = variants.map(v => 
        `<option value="${v.color}" data-img="${v.image}">${v.color}</option>`
    ).join('');

    // Generate Thumbnails
    let thumbnailsHtml = '';
    if (variants.length > 1) {
        thumbnailsHtml = `
            <div class="modal-thumbnails">
                ${variants.map((v, index) => `
                    <img src="${v.image}" 
                         alt="${v.color}" 
                         onclick="updateModalImage('${v.image}', '${v.color}', this)"
                         class="thumb-img ${index === 0 ? 'active' : ''}">
                `).join('')}
            </div>`;
    }

    // Initial Image (first variant or product main image)
    const initialImg = variants[0].image || product.img;

    modalBody.innerHTML = `
        <div class="modal-left">
            <div class="modal-img-container" id="modal-swipe-container">
                <img src="${initialImg}" alt="${product.name}" class="modal-img" id="modal-main-img">
            </div>
            ${thumbnailsHtml}
        </div>
        <div class="modal-info">
            <div style="margin-bottom: 5px; opacity: 0.6; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 2px;">Rare Root</div>
            <h2>${product.name}</h2>
            <div class="modal-price">${priceDisplay}</div>
            
            <div class="modal-description">
                ${product.description || "Premium quality fabric, designed for the disciplined. Built for movement and style."}
            </div>
            
            <div class="modal-opt-group">
                <label class="modal-opt-label">Select Size</label>
                <select id="modal-size" class="modal-select">
                    ${sizeOptions}
                </select>
            </div>
            
            <div class="modal-opt-group">
                <label class="modal-opt-label">Select Variant</label>
                <select id="modal-color" class="modal-select" onchange="onColorChange(this)">
                    ${colorOptions}
                </select>
            </div>

            <button class="btn-add-modal" onclick="addToCartFromModal()">
                Add to Bag - ₦${actualPrice.toLocaleString()}
            </button>
        </div>
    `;

    // Add Swipe Logic
    initSwipe(variants);

    modal.style.display = "block";
}

function initSwipe(variants) {
    const container = document.getElementById('modal-swipe-container');
    if (!container || variants.length <= 1) return;

    let startX = 0;
    let currentIndex = 0;

    container.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    }, {passive: true});

    container.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = startX - endX;

        if (Math.abs(diff) > 50) { // Threshold for swipe
            if (diff > 0) {
                // Swipe Left -> Next
                currentIndex = (currentIndex + 1) % variants.length;
            } else {
                // Swipe Right -> Prev
                currentIndex = (currentIndex - 1 + variants.length) % variants.length;
            }
            const v = variants[currentIndex];
            updateModalImage(v.image, v.color, document.querySelectorAll('.thumb-img')[currentIndex]);
        }
    }, {passive: true});
}

function updateModalImage(src, color, thumbEl) {
    const img = document.getElementById('modal-main-img');
    if(img) {
        img.style.opacity = '0.5';
        setTimeout(() => {
            img.src = src;
            img.style.opacity = '1';
        }, 200);
    }
    
    // Also update the select dropdown if color is provided
    if (color) {
        const select = document.getElementById('modal-color');
        if (select) select.value = color;
    }

    // Update active thumbnail state
    if (thumbEl) {
        document.querySelectorAll('.thumb-img').forEach(el => el.classList.remove('active'));
        thumbEl.classList.add('active');
    }
}

function onColorChange(select) {
    const selectedOption = select.options[select.selectedIndex];
    const imgSrc = selectedOption.getAttribute('data-img');
    const color = select.value;
    
    if (imgSrc) {
        const img = document.getElementById('modal-main-img');
        if(img) img.src = imgSrc;
        
        // Find matching thumbnail to highlight
        const thumbnails = document.querySelectorAll('.thumb-img');
        thumbnails.forEach(thumb => {
            if (thumb.getAttribute('alt') === color) {
                thumb.classList.add('active');
            } else {
                thumb.classList.remove('active');
            }
        });
    }
}

function closeModal() {
    document.getElementById('product-modal').style.display = "none";
    currentModalProduct = null;
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('product-modal');
    if (event.target == modal) {
        closeModal();
    }
}

function addToCartFromModal() {
    if (!currentModalProduct) return;

    const size = document.getElementById('modal-size').value;
    const colorSelect = document.getElementById('modal-color');
    const color = colorSelect.value;
    const selectedOption = colorSelect.options[colorSelect.selectedIndex];
    const variantImg = selectedOption.getAttribute('data-img');

    const price = currentModalProduct.sale_price || currentModalProduct.price;

    // Check if item already in cart with same size and color
    const existingItem = cart.find(item => 
        item.id === currentModalProduct.id && 
        item.selectedSize === size && 
        item.selectedColor === color
    );

    if (existingItem) {
        existingItem.quantity = (existingItem.quantity || 1) + 1;
    } else {
        const cartItem = {
            ...currentModalProduct,
            img: variantImg || currentModalProduct.img,
            selectedSize: size,
            selectedColor: color,
            finalPrice: price,
            quantity: 1,
            cartId: Date.now()
        };
        cart.push(cartItem);
    }

    updateCartUI();
    closeModal();
    showToast(`Added ${currentModalProduct.name} to bag`);
    toggleCart();
}

// ------------------------------------------------
// 4. CART LOGIC
// ------------------------------------------------
function updateCartUI() {
    const cartItemsContainer = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const cartTotal = document.getElementById('cart-total');

    // Update Count
    const totalQty = cart.reduce((acc, item) => acc + (item.quantity || 1), 0);
    cartCount.innerText = totalQty;

    // Update Items
    cartItemsContainer.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = `
            <div class="empty-cart">
                <img src="https://files.fm/thumb.php?i=4wunrd26s5" alt="RARE ROOT">
                <button class="btn-checkout" style="margin-top: 2rem;" onclick="toggleCart()">START SHOPPING</button>
            </div>
        `;
    } else {
        cart.forEach((item) => {
            const itemTotal = item.finalPrice * (item.quantity || 1);
            total += itemTotal;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'cart-item';
            itemDiv.innerHTML = `
                <img src="${item.img}" alt="${item.name}">
                <div class="cart-item-info">
                    <div class="cart-item-name">${item.name}</div>
                    <div class="cart-item-meta">${item.selectedSize} | ${item.selectedColor}</div>
                    <div class="cart-item-price">₦${item.finalPrice.toLocaleString()}</div>
                    <div class="cart-item-qty">
                        <button class="qty-btn" onclick="updateQty(${item.cartId}, -1)">-</button>
                        <span>${item.quantity || 1}</span>
                        <button class="qty-btn" onclick="updateQty(${item.cartId}, 1)">+</button>
                    </div>
                </div>
                <div class="cart-item-remove" onclick="removeFromCart(${item.cartId})">
                    <i class="fas fa-times"></i>
                </div>
            `;
            cartItemsContainer.appendChild(itemDiv);
        });
    }

    // Update Total
    cartTotal.innerText = '₦' + total.toLocaleString();
}

function updateQty(cartId, delta) {
    const item = cart.find(i => i.cartId === cartId);
    if (item) {
        item.quantity = (item.quantity || 1) + delta;
        if (item.quantity <= 0) {
            removeFromCart(cartId);
        } else {
            updateCartUI();
        }
    }
}

function checkoutWhatsApp() {
    if (cart.length === 0) {
        showToast("Your bag is empty!");
        return;
    }

    let message = "Hello RARE ROOT, I'd like to place an order:\n\n";
    let total = 0;

    cart.forEach(item => {
        const itemTotal = item.finalPrice * (item.quantity || 1);
        message += `• ${item.name}\n`;
        message += `  Size: ${item.selectedSize}\n`;
        message += `  Color: ${item.selectedColor}\n`;
        message += `  Qty: ${item.quantity || 1}\n`;
        message += `  Price: ₦${itemTotal.toLocaleString()}\n\n`;
        total += itemTotal;
    });

    message += `*Total Amount: ₦${total.toLocaleString()}*\n\n`;
    message += "Please provide payment details.";

    const encodedMessage = encodeURIComponent(message);
}

function checkoutPaystack() {
    if (cart.length === 0) {
        showToast("Your bag is empty!");
        return;
    }
    const emailInput = document.getElementById('checkout-email');
    const email = emailInput ? emailInput.value.trim() : '';
    if (!email || !email.includes('@')) {
        showToast("Email is required for payment.");
        return;
    }
    const totalAmount = cart.reduce((sum, item) => sum + item.finalPrice * (item.quantity || 1), 0);
    try {
        const handler = PaystackPop.setup({
            key: PAYSTACK_PUBLIC_KEY,
            email: email,
            amount: Math.round(totalAmount * 100),
            currency: 'NGN',
            ref: 'RR-' + Date.now(),
            metadata: {
                cart: cart.map(i => ({
                    id: i.id,
                    name: i.name,
                    size: i.selectedSize,
                    color: i.selectedColor,
                    qty: i.quantity || 1,
                    unit_price: i.finalPrice
                })),
                total: totalAmount
            },
            callback: function (response) {
                showToast("Payment successful. Ref: " + response.reference);
                cart = [];
                updateCartUI();
                toggleCart();
            },
            onClose: function () {
                showToast("Payment window closed.");
            }
        });
        handler.openIframe();
    } catch (e) {
        console.error(e);
        alert("Unable to initialize Paystack. Please ensure the public key is set.");
    }
}
function removeFromCart(cartId) {
    cart = cart.filter(item => item.cartId !== cartId);
    updateCartUI();
}

function toggleCart() {
    const drawer = document.getElementById('cart-drawer');
    const overlay = document.getElementById('overlay');
    
    if (drawer.classList.contains('open')) {
        drawer.classList.remove('open');
        overlay.classList.remove('active');
    } else {
        document.getElementById('menu-drawer').classList.remove('open');
        drawer.classList.add('open');
        overlay.classList.add('active');
    }
}

function toggleMenu() {
    const drawer = document.getElementById('menu-drawer');
    const overlay = document.getElementById('overlay');
    
    if (drawer.classList.contains('open')) {
        drawer.classList.remove('open');
        overlay.classList.remove('active');
    } else {
        document.getElementById('cart-drawer').classList.remove('open');
        drawer.classList.add('open');
        overlay.classList.add('active');
    }
}

function closeAllDrawers() {
    document.getElementById('menu-drawer').classList.remove('open');
    document.getElementById('cart-drawer').classList.remove('open');
    document.getElementById('overlay').classList.remove('active');
}

// ------------------------------------------------
// 5. SEARCH LOGIC
// ------------------------------------------------
function handleSearch(query) {
    const term = query.toLowerCase();
    
    if (!term) {
        // Reset to default view
        initializeShop();
        return;
    }

    // Find all matching products
    const matches = products.filter(p => 
        !p.hidden && (
            p.name.toLowerCase().includes(term) || 
            p.category.toLowerCase().includes(term) ||
             (p.tags && p.tags.some(tag => (typeof tag === 'string' ? tag : tag.tag || '').toLowerCase().includes(term))) ||
             (p.description && p.description.toLowerCase().includes(term))
         )
    );

    // Render Search Results (Hi-jack one grid or create a results view)
    // Strategy: Hide all grids, show results in the first one with a title change
    
    // Simplest approach: Filter the existing grids in place? 
    // No, because a search might return items from multiple categories.
    // Better: Clear all grids, and render matches into the first grid (The Exchange) and hide others titles.
    
    document.getElementById('exchange-grid').innerHTML = '';
    document.getElementById('kinetic-grid').innerHTML = '';
    document.getElementById('urban-grid').innerHTML = '';
    
    // Hide headers temporarily (optional, but cleaner)
    document.querySelectorAll('.collection-header').forEach(el => el.style.display = 'none');
    
    // Create a temporary results header if not exists
    let resultsHeader = document.getElementById('search-results-header');
    if (!resultsHeader) {
        resultsHeader = document.createElement('div');
        resultsHeader.id = 'search-results-header';
        resultsHeader.className = 'collection-header';
        resultsHeader.innerHTML = '<h2 class="category-title">Search Results</h2>';
        document.getElementById('exchange-grid').parentNode.insertBefore(resultsHeader, document.getElementById('exchange-grid'));
    }
    resultsHeader.style.display = 'block';

    if (matches.length === 0) {
        document.getElementById('exchange-grid').innerHTML = '<p style="text-align:center; padding:40px;">No products found.</p>';
    } else {
        const container = document.getElementById('exchange-grid');
        matches.forEach(product => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.onclick = () => openProductModal(product.id);
            
            const isSale = product.sale_price && product.sale_price < product.price;
            const priceDisplay = isSale 
                ? `<span class="original-price">₦${product.price.toLocaleString()}</span> <span class="sale-price">₦${product.sale_price.toLocaleString()}</span>` 
                : `₦${product.price.toLocaleString()}`;
            
            const discountBadge = isSale 
                ? `<span class="discount-badge">-${Math.round(((product.price - product.sale_price) / product.price) * 100)}%</span>` 
                : '';

            card.innerHTML = `
                <div class="product-image-container">
                    ${discountBadge}
                    <img src="${product.img}" alt="${product.name}" loading="lazy">
                    <button class="add-to-cart-btn">
                    VIEW OPTIONS
                </button>
                </div>
                <div class="product-info">
                    <h3>${product.name}</h3>
                    <p class="price">${priceDisplay}</p>
                </div>
            `;
            container.appendChild(card);
        });
    }
}

// Reset view helper (when search is cleared)
document.getElementById('search-input').addEventListener('input', (e) => {
    if (e.target.value === '') {
        document.querySelectorAll('.collection-header').forEach(el => el.style.display = 'block');
        const resultsHeader = document.getElementById('search-results-header');
        if (resultsHeader) resultsHeader.style.display = 'none';
        initializeShop();
    }
});


// ------------------------------------------------
// 6. UTILITIES (Toast, Checkout)
// ------------------------------------------------
function showToast(message) {
    const toast = document.getElementById("toast");
    if (!toast) return;
    toast.innerText = message;
    toast.className = "toast show";
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

function checkout() {
    if (cart.length === 0) {
        showToast("Your bag is empty.");
        return;
    }
    let totalAmount = cart.reduce((sum, item) => sum + item.finalPrice, 0);
    let email = prompt("Enter your email for the receipt:");
    if (email) {
        // Simulating Paystack for now
        alert(`Proceeding to payment of ₦${totalAmount.toLocaleString()} for ${email}`);
        // In real integration: PaystackPop.setup({...}).openIframe();
    }
}

// ------------------------------------------------
// INITIALIZATION
// ------------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
    fetchProducts();
    
    // Initialize Netlify Identity if present
    // (Disabled for GitHub Pages compatibility)
    // if (window.netlifyIdentity) { ... }
});
    </script>
</body>
</html>
