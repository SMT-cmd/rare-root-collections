<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RARE ROOT | Prestige</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
/* -------------------------------------------------------
   THEME: WINE & BROWN COTTON TEXTURE
   ------------------------------------------------------- */
:root {
    --bg-wine: #2c1b18; /* Deep Earthy Wine */
    --bg-cotton: #3e2723; /* Brown Cotton Undertone */
    --text-gold: #e0c097; /* Muted Gold for Prestige */
    --text-cream: #f4f1ea; /* Soft White */
    --accent-red: #8a2be2; /* Subtle Royal Touch */
    --glass: rgba(62, 39, 35, 0.85);
}

body {
    margin: 0;
    padding: 0;
    font-family: 'Montserrat', sans-serif;
    background-color: var(--bg-wine);
    color: var(--text-cream);
    overflow-x: hidden;
    background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 3h1v1H1V3zm2-2h1v1H3V1z' fill='%23000000' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
}

/* -------------------------------------------------------
   ANIMATIONS
   ------------------------------------------------------- */
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

/* -------------------------------------------------------
   HEADER & MENU
   ------------------------------------------------------- */
nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 30px 40px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(44, 27, 24, 0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(224, 192, 151, 0.1);
}

.logo {
    font-family: 'Cinzel', serif;
    font-size: 1.8rem;
    letter-spacing: 2px;
    color: var(--text-gold);
    text-transform: uppercase;
    font-weight: 700;
    text-decoration: none;
}

.menu-btn {
    background: none;
    border: none;
    color: var(--text-cream);
    font-size: 1.5rem;
    cursor: pointer;
    transition: transform 0.3s;
}
.menu-btn:hover { transform: scale(1.1); color: var(--text-gold); }

.cart-icon {
    position: relative;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    color: var(--text-gold);
}
.cart-count {
    position: absolute;
    top: -8px;
    right: -10px;
    background: var(--text-cream);
    color: var(--bg-wine);
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 50%;
    font-weight: bold;
}


.nav-logo-img {
    height: 140px;
    width: auto;
    vertical-align: middle;
    transition: transform 0.3s ease;
    filter: drop-shadow(0 0 2px rgba(224, 192, 151, 0.3));
}

.nav-logo-img:hover {
    transform: scale(1.05);
}

/* -------------------------------------------------------
   HERO SECTION
   ------------------------------------------------------- */
.hero {
    text-align: center;
    padding: 180px 20px;
    animation: fadeIn 1s ease-out;
    background: radial-gradient(circle at center, rgba(62, 39, 35, 0.6) 0%, rgba(44, 27, 24, 0) 80%);
}

.hero-title {
    font-family: 'Cinzel', serif;
    font-size: 4.5rem;
    color: var(--text-gold);
    margin-bottom: 20px;
    line-height: 1.1;
    text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
    letter-spacing: 2px;
}

.hero-subtitle {
    font-size: 1.4rem;
    letter-spacing: 5px;
    text-transform: uppercase;
    color: var(--text-cream);
    opacity: 0.9;
    font-weight: 300;
}

.btn-hero {
    background: transparent;
    border: 2px solid var(--text-gold);
    color: var(--text-gold);
    padding: 15px 40px;
    font-family: 'Cinzel', serif;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 30px;
}
.btn-hero:hover {
    background: var(--text-gold);
    color: var(--bg-wine);
}

/* -------------------------------------------------------
   LAYOUT & GRID
   ------------------------------------------------------- */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
}

.collection-header {
    margin: 80px 0 40px;
    text-align: center;
    border-bottom: 1px solid rgba(224, 192, 151, 0.2);
    padding-bottom: 20px;
}

.category-title {
    font-family: 'Cinzel', serif;
    font-size: 2.5rem;
    color: var(--text-gold);
    margin-bottom: 10px;
}

.category-subtitle {
    font-style: italic;
    opacity: 0.7;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 40px;
    margin-bottom: 60px;
}

/* -------------------------------------------------------
   PRODUCT CARDS
   ------------------------------------------------------- */
.product-card {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.05);
    transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    border-color: var(--text-gold);
}

.product-image-container {
    width: 100%;
    height: 400px;
    overflow: hidden;
    position: relative;
}

.product-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s;
}

.product-card:hover .product-image-container img {
    transform: scale(1.05);
}

.discount-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: var(--accent-red);
    color: #fff;
    padding: 5px 10px;
    font-size: 0.8rem;
    font-weight: bold;
    z-index: 2;
    border-radius: 2px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

.add-to-cart-btn {
    position: absolute;
    bottom: -50px;
    left: 0;
    width: 100%;
    padding: 15px;
    background: rgba(44, 27, 24, 0.9);
    color: var(--text-gold);
    border: none;
    text-transform: uppercase;
    font-weight: bold;
    cursor: pointer;
    transition: bottom 0.3s ease-in-out;
    backdrop-filter: blur(5px);
}

.product-card:hover .add-to-cart-btn {
    bottom: 0;
}

.add-to-cart-btn:hover {
    background: var(--text-gold);
    color: var(--bg-wine);
}

.product-info {
    padding: 20px;
    text-align: center;
}

.product-info h3 {
    font-family: 'Cinzel', serif;
    font-size: 1.1rem;
    margin-bottom: 10px;
    color: var(--text-cream);
    min-height: 40px; /* Ensure alignment */
}

.product-info .price {
    font-weight: 600;
    color: var(--text-gold);
    margin-bottom: 0;
}

.original-price {
    text-decoration: line-through;
    color: #888;
    font-size: 0.9em;
    margin-right: 8px;
}

.sale-price {
    color: var(--accent-red);
    font-weight: bold;
}

/* -------------------------------------------------------
   NEWSLETTER
   ------------------------------------------------------- */
.newsletter-section {
    background: rgba(0,0,0,0.2);
    padding: 80px 20px;
    text-align: center;
    margin-top: 100px;
}

.newsletter-content h3 {
    font-family: 'Cinzel', serif;
    font-size: 2rem;
    color: var(--text-gold);
    margin-bottom: 10px;
}

.newsletter-form {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 30px;
}

.newsletter-form input {
    padding: 15px;
    width: 300px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-cream);
}

.newsletter-form button {
    padding: 15px 30px;
    background: var(--text-gold);
    border: none;
    color: var(--bg-wine);
    font-weight: bold;
    cursor: pointer;
}

/* -------------------------------------------------------
   FOOTER
   ------------------------------------------------------- */
footer {
    background: #1a0f0d;
    padding: 80px 40px 20px;
    border-top: 1px solid var(--text-gold);
}

.footer-content {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 40px;
    max-width: 1400px;
    margin: 0 auto;
}

.footer-col h4 {
    font-family: 'Cinzel', serif;
    color: var(--text-gold);
    margin-bottom: 20px;
}

.footer-col p {
    line-height: 1.6;
}

.footer-col a {
    display: block;
    color: var(--text-cream);
    opacity: 0.6;
    text-decoration: none;
    margin-bottom: 10px;
    transition: opacity 0.3s;
}

.footer-col a:hover {
    opacity: 1;
    color: var(--text-gold);
}

.footer-bottom {
    text-align: center;
    margin-top: 60px;
    padding-top: 20px;
    border-top: 1px solid rgba(255,255,255,0.05);
}

.footer-bottom p {
    font-size: 0.8rem;
    opacity: 0.4;
}

/* -------------------------------------------------------
   TOAST NOTIFICATION
   ------------------------------------------------------- */
.toast {
    visibility: hidden;
    min-width: 250px;
    background-color: var(--text-gold);
    color: var(--bg-wine);
    text-align: center;
    border-radius: 2px;
    padding: 16px;
    position: fixed;
    z-index: 1001;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-size: 1rem;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.toast.show {
    visibility: visible;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
}

@keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .hero-title { font-size: 2.8rem; }
    .hero-subtitle { font-size: 1rem; }
    .newsletter-form { flex-direction: column; }
    .footer-content { grid-template-columns: 1fr; text-align: center; }
}

/* -------------------------------------------------------
   MOBILE MENU DRAWER
   ------------------------------------------------------- */
.menu-drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px;
    height: 100%;
    background: #251614;
    box-shadow: 5px 0 30px rgba(0,0,0,0.5);
    transform: translateX(-100%);
    transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
    z-index: 1000;
    padding: 30px;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--text-gold);
}

.menu-drawer.open { transform: translateX(0); }

.menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 20px;
    margin-bottom: 30px;
}

.menu-title { font-family: 'Cinzel', serif; color: var(--text-gold); font-size: 1.5rem; }
.close-menu { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }

.menu-links {
    list-style: none;
    padding: 0;
    margin: 0;
}

.menu-links li {
    margin-bottom: 20px;
}

.menu-links a {
    color: var(--text-cream);
    text-decoration: none;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: color 0.3s;
}

.menu-links a:hover {
    color: var(--text-gold);
}

/* -------------------------------------------------------
   CART DRAWER (Reconstructed)
   ------------------------------------------------------- */
.cart-drawer {
    position: fixed;
    top: 0;
    right: 0;
    width: 400px;
    max-width: 100%;
    height: 100%;
    background: #251614;
    box-shadow: -5px 0 30px rgba(0,0,0,0.5);
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
    z-index: 1000;
    padding: 30px;
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--text-gold);
}

.cart-drawer.open { transform: translateX(0); }

.cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    padding-bottom: 20px;
    margin-bottom: 20px;
}

.cart-title { font-family: 'Cinzel', serif; color: var(--text-gold); font-size: 1.5rem; }
.close-cart { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }

.cart-items { flex: 1; overflow-y: auto; }

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.cart-footer {
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 20px;
}

.total-price {
    display: flex;
    justify-content: space-between;
    font-size: 1.2rem;
    margin-bottom: 20px;
    font-weight: bold;
    color: var(--text-gold);
}

.btn-checkout {
    width: 100%;
    padding: 15px;
    background: var(--text-gold);
    color: var(--bg-wine);
    border: none;
    font-weight: bold;
    cursor: pointer;
    font-family: 'Cinzel', serif;
}

.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 900;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}
.overlay.active { opacity: 1; pointer-events: auto; }

/* -------------------------------------------------------
   NAV ACTIONS & MODAL (NEW)
   ------------------------------------------------------- */
.nav-actions {
    display: flex;
    align-items: center;
    gap: 20px;
}

.search-box input {
    background: transparent;
    border: 1px solid rgba(224, 192, 151, 0.3);
    color: var(--text-cream);
    padding: 8px 15px;
    border-radius: 20px;
    font-family: 'Montserrat', sans-serif;
    width: 150px;
    transition: all 0.3s;
}

.search-box input:focus {
    width: 220px;
    border-color: var(--text-gold);
    outline: none;
    background: rgba(0,0,0,0.1);
}

/* Modal */
.modal {
    display: none; 
    position: fixed; 
    z-index: 2000; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.8); 
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s;
}

.modal-content {
    background-color: var(--bg-wine);
    margin: 5% auto; 
    padding: 0; 
    border: 1px solid var(--text-gold);
    width: 90%; 
    max-width: 900px;
    position: relative;
    border-radius: 4px;
    box-shadow: 0 10px 50px rgba(0,0,0,0.7);
}

.color-swatch {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid #555;
    cursor: pointer;
    display: inline-block;
    margin-right: 10px;
    position: relative;
    transition: transform 0.2s;
}
.color-swatch:hover { transform: scale(1.1); }
.color-swatch.selected {
    border-color: var(--text-gold);
    box-shadow: 0 0 8px var(--text-gold);
    transform: scale(1.1);
}
.color-swatch-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 5px;
    margin-bottom: 10px;
}

.close-modal {
    color: var(--text-gold);
    float: right;
    font-size: 28px;
    font-weight: bold;
    position: absolute;
    right: 20px;
    top: 10px;
    cursor: pointer;
    z-index: 10;
}
.close-modal:hover { color: #fff; }

.modal-body {
    padding: 0;
    display: block; /* Reset grid to allow inner flex/grid control */
}

.modal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
}

.modal-image {
    position: relative;
    background: #000;
    height: 100%;
    min-height: 400px;
}

.modal-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.modal-details {
    padding: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.modal-badge {
    top: 20px;
    left: 20px;
    padding: 8px 15px;
    font-size: 1rem;
}

@media (max-width: 768px) {
    .modal-grid { grid-template-columns: 1fr; }
    .search-box input { width: 100px; }
    .search-box input:focus { width: 150px; }
    .modal-image { min-height: 300px; }
    .modal-details { padding: 20px; }
}

.modal-info h2 { font-family: 'Cinzel', serif; color: var(--text-gold); margin-top: 0; }
.modal-price { font-size: 1.5rem; margin-bottom: 20px; color: var(--text-cream); }
.modal-price .old-price { text-decoration: line-through; color: #888; font-size: 1rem; margin-right: 10px; }
.modal-opt-group { margin-bottom: 20px; }
.modal-opt-label { display: block; margin-bottom: 10px; font-weight: 600; color: #aaa; }
.modal-select { 
    background: transparent; 
    color: var(--text-cream); 
    border: 1px solid rgba(255,255,255,0.2); 
    padding: 10px; 
    width: 100%; 
    font-family: inherit;
    cursor: pointer;
}
.modal-select:focus { border-color: var(--text-gold); outline: none; }

/* FOOTER UPDATES */
.footer-logo {
    height: 60px;
    margin-bottom: 1rem;
    display: block;
}

.brand-col p {
    margin-top: 0.5rem;
    font-style: italic;
    color: var(--text-gold);
}

.footer-bottom {
    text-align: center;
    padding-top: 20px;
    margin-top: 20px;
    border-top: 1px solid rgba(224, 192, 151, 0.1);
    color: #888;
    font-size: 0.9rem;
}
    </style>
    <!-- Favicon -->
    <link rel="icon" href="https://files.fm/thumb.php?i=y628qspy4s" type="image/jpeg">
    
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <!-- Removed Netlify Identity Script -->
</head>
<body>

    <nav>
        <button class="menu-btn" onclick="toggleMenu()">☰</button>
        <a href="#" class="logo">
            <img src="https://files.fm/thumb.php?i=4wunrd26s5" alt="RARE ROOT" class="nav-logo-img">
        </a>
        <div class="nav-actions">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search..." onkeyup="handleSearch(this.value)">
            </div>
            <div class="cart-icon" onclick="toggleCart()">
                CART <span id="cart-count" class="cart-count">0</span>
            </div>
        </div>
    </nav>

    <div class="hero">
        <div class="hero-content">
            <h1 class="hero-title">RARE ROOT<br>COLLECTIONS</h1>
            <p class="hero-subtitle">The 2026 Collection</p>
            <button class="btn-hero" onclick="document.getElementById('exchange-grid').scrollIntoView({behavior: 'smooth'})">Explore Collection</button>
        </div>
    </div>

    <div class="container">
        <!-- Brand Identity Section -->
        <div class="brand-identity" style="text-align: center; padding: 40px 20px; max-width: 800px; margin: 0 auto;">
            <p style="font-family: 'Cinzel', serif; font-size: 1.2rem; color: var(--text-gold); line-height: 1.8;">
                RARE ROOT is a premium streetwear collective designed for the disciplined. Rooted in Nigeria and serving the global hustle, we provide the high-performance uniform for those who move in silence. Analyzing charts during a late-night trading session or pushing past your limits at the gym, our apparel represents your dedication to the grind.
            </p>
        </div>

    <div class="collection-header">
        <h2 class="category-title">THE EXCHANGE</h2>
        <p class="category-subtitle">Calculated Moves. Legacy Built.</p>
    </div>
    <div class="grid" id="exchange-grid"></div>

    <div class="collection-header">
        <h2 class="category-title">KINETIC</h2>
        <p class="category-subtitle">Form Meets Function. The Street Performance Line.</p>
    </div>
    <div class="grid" id="kinetic-grid"></div>

    <div class="collection-header">
        <h2 class="category-title">URBAN ARCHIVE</h2>
        <p class="category-subtitle">The Signature Street Silhouettes.</p>
    </div>
    <div class="grid" id="urban-grid"></div>

    </div>

    <!-- Newsletter Section -->
    <div class="newsletter-section">
        <div class="newsletter-content">
            <h3>Join The Inner Circle</h3>
            <p>Exclusive drops, early access, and insider trading.</p>
            <form class="newsletter-form" onsubmit="event.preventDefault(); alert('Welcome to the inner circle.');">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">Subscribe</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-col brand-col">
                <img src="https://files.fm/thumb.php?i=y628qspy4s" alt="RARE ROOT" class="footer-logo">
                <p>Prestige in every thread.</p>
            </div>
            <div class="footer-col">
                <h4>Shop</h4>
                <a href="#exchange-grid">The Exchange</a>
                <a href="#kinetic-grid">Kinetic</a>
                <a href="#urban-grid">Urban Archive</a>
            </div>
            <div class="footer-col">
                <h4>Support</h4>
                <a href="#">Shipping & Returns</a>
                <a href="#">Size Guide</a>
                <a href="#">Contact Us</a>
                <a href="admin/index.html" style="opacity: 0.5; font-size: 0.8rem;">Admin Access</a>
            </div>
            <div class="footer-col">
                <h4>Stay Connected</h4>
                <div class="social-links">
                    <a href="#">Instagram</a>
                    <a href="#">Twitter</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 RARE ROOT. All rights reserved.</p>
        </div>
    </footer>

    <div class="overlay" id="overlay" onclick="closeAllDrawers()"></div>

    <!-- Mobile Menu Drawer -->
    <div class="menu-drawer" id="menu-drawer">
        <div class="menu-header">
            <span class="menu-title">Menu</span>
            <button class="close-menu" onclick="toggleMenu()">×</button>
        </div>
        <ul class="menu-links">
            <li><a href="#" onclick="toggleMenu()">Home</a></li>
            <li><a href="#exchange-grid" onclick="toggleMenu()">The Exchange</a></li>
            <li><a href="#kinetic-grid" onclick="toggleMenu()">Kinetic</a></li>
            <li><a href="#urban-grid" onclick="toggleMenu()">Urban Archive</a></li>
            <li><a href="footer" onclick="toggleMenu()">Contact</a></li>
        </ul>
    </div>

    <div class="cart-drawer" id="cart-drawer">
        <div class="cart-header">
            <span class="cart-title">Your Bag</span>
            <button class="close-cart" onclick="toggleCart()">×</button>
        </div>
        <div class="cart-items" id="cart-items">
            <p style="text-align:center; color:#888; margin-top:20px;">Your bag is empty.</p>
        </div>
        <div class="cart-footer">
            <div class="total-price">
                <span>Total</span>
                <span id="cart-total">₦0</span>
            </div>
            <button class="btn-checkout" onclick="checkout()">Checkout Now</button>
        </div>
    </div>

    <div id="toast" class="toast">Notification</div>

    <!-- Product Details Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-body" id="modal-body">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Script removed for GitHub Pages compatibility -->
    <script>
// ------------------------------------------------
// 1. DATABASE & STATE
// ------------------------------------------------
let products = [];
let cart = [];
let currentModalProduct = null;

// Fetch Products from JSON (Simulating Database)
async function fetchProducts() {
    try {
        const response = await fetch('data/products.json?t=' + new Date().getTime());
        const data = await response.json();
        products = data.products || [];
        initializeShop();
    } catch (error) {
        console.error('Error loading products:', error);
        showToast('Error loading shop inventory.');
    }
}

function initializeShop() {
    // Render all categories
    const categories = [...new Set(products.map(p => p.category))];
    
    // Clear existing grids first (in case of re-init)
    document.querySelectorAll('.grid').forEach(grid => grid.innerHTML = '');

    // If we have specific grids in HTML, render to them
    renderCategory("Gym Wear for Traders", "exchange-grid");
    renderCategory("Street Wear", "kinetic-grid");
    renderCategory("Brand Casuals", "urban-grid");
    
    // Also render others if they exist in data but not explicitly in HTML structure
    // (Future proofing: dynamic category creation could go here)
}

// ------------------------------------------------
// 2. RENDERING
// ------------------------------------------------
function renderCategory(categoryName, elementId) {
    const container = document.getElementById(elementId);
    if (!container) return; 
    
    // Filter by category and ensure not hidden
    const items = products.filter(p => p.category === categoryName && !p.hidden);
    
    if (items.length === 0) {
        // Optional: Hide section if empty
        // container.previousElementSibling.style.display = 'none';
        container.innerHTML = '<p style="grid-column: 1/-1; text-align:center; opacity:0.5;">Coming Soon</p>';
        return;
    }

    container.innerHTML = ''; // Clear current content
    
    items.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.onclick = () => openProductModal(product.id);
        
        const isSale = product.sale_price && product.sale_price < product.price;
        const priceDisplay = isSale 
            ? `<span class="original-price">₦${product.price.toLocaleString()}</span> <span class="sale-price">₦${product.sale_price.toLocaleString()}</span>` 
            : `₦${product.price.toLocaleString()}`;
        
        const discountBadge = isSale 
            ? `<span class="discount-badge">-${Math.round(((product.price - product.sale_price) / product.price) * 100)}%</span>` 
            : '';

        card.innerHTML = `
            <div class="product-image-container">
                ${discountBadge}
                <img src="${product.img}" alt="${product.name}" loading="lazy">
                <button class="add-to-cart-btn">
                    Quick View
                </button>
            </div>
            <div class="product-info">
                <h3>${product.name}</h3>
                <p class="price">${priceDisplay}</p>
            </div>
        `;
        container.appendChild(card);
    });
}

// ------------------------------------------------
// 3. PRODUCT MODAL & SELECTION
// ------------------------------------------------
function openProductModal(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;

    currentModalProduct = product;
    const modal = document.getElementById('product-modal');
    const modalBody = document.getElementById('modal-body');

    // Price Logic
    let priceDisplay = `₦${product.price.toLocaleString()}`;
    let actualPrice = product.price;
    if (product.sale_price) {
        priceDisplay = `<span class="old-price">₦${product.price.toLocaleString()}</span> ₦${product.sale_price.toLocaleString()}`;
        actualPrice = product.sale_price;
    }

    // Generate Size Options
    let sizeOptions = product.sizes ? product.sizes.map(s => `<option value="${s}">${s}</option>`).join('') : '<option>One Size</option>';
    
    // Generate Color Options
    let colorOptions = product.colors ? product.colors.map(c => `<option value="${c.color}">${c.color}</option>`).join('') : '<option>Standard</option>';

    modalBody.innerHTML = `
        <div class="modal-left">
            <img src="${product.img}" alt="${product.name}" class="modal-img">
        </div>
        <div class="modal-info">
            <h2>${product.name}</h2>
            <div class="modal-price">${priceDisplay}</div>
            <p style="opacity:0.8; margin-bottom:20px;">${product.description || "Premium quality fabric, designed for the driven."}</p>
            
            <div class="modal-opt-group">
                <label class="modal-opt-label">Size</label>
                <select id="modal-size" class="modal-select">
                    ${sizeOptions}
                </select>
            </div>
            
            <div class="modal-opt-group">
                <label class="modal-opt-label">Color</label>
                <select id="modal-color" class="modal-select">
                    ${colorOptions}
                </select>
            </div>

            <button class="btn-checkout" onclick="addToCartFromModal()">Add to Bag - ₦${actualPrice.toLocaleString()}</button>
        </div>
    `;

    modal.style.display = "block";
}

function closeModal() {
    document.getElementById('product-modal').style.display = "none";
    currentModalProduct = null;
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('product-modal');
    if (event.target == modal) {
        closeModal();
    }
}

function addToCartFromModal() {
    if (!currentModalProduct) return;

    const size = document.getElementById('modal-size').value;
    const color = document.getElementById('modal-color').value;
    const price = currentModalProduct.sale_price || currentModalProduct.price;

    const cartItem = {
        ...currentModalProduct,
        selectedSize: size,
        selectedColor: color,
        finalPrice: price,
        cartId: Date.now() // Unique ID for cart entry
    };

    cart.push(cartItem);
    updateCartUI();
    closeModal();
    showToast(`Added ${currentModalProduct.name} (${size})`);
    toggleCart(); // Open cart to show item
}

// ------------------------------------------------
// 4. CART LOGIC
// ------------------------------------------------
function updateCartUI() {
    const cartItemsContainer = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const cartTotal = document.getElementById('cart-total');

    // Update Count
    cartCount.innerText = cart.length;

    // Update Items
    cartItemsContainer.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">Your bag is empty.</p>';
    } else {
        cart.forEach((item, index) => {
            total += item.finalPrice;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'cart-item';
            itemDiv.innerHTML = `
                <div>
                    <div style="color:white; font-weight:bold;">${item.name}</div>
                    <div style="font-size:0.8rem; color:#888;">${item.selectedSize} | ${item.selectedColor}</div>
                </div>
                <div style="text-align:right;">
                    <div>₦${item.finalPrice.toLocaleString()}</div>
                    <div style="color:#aa4444; font-size:0.8rem; cursor:pointer;" onclick="removeFromCart(${item.cartId})">Remove</div>
                </div>
            `;
            cartItemsContainer.appendChild(itemDiv);
        });
    }

    // Update Total
    cartTotal.innerText = '₦' + total.toLocaleString();
}

function removeFromCart(cartId) {
    cart = cart.filter(item => item.cartId !== cartId);
    updateCartUI();
}

function toggleCart() {
    const drawer = document.getElementById('cart-drawer');
    const overlay = document.getElementById('overlay');
    
    if (drawer.classList.contains('open')) {
        drawer.classList.remove('open');
        overlay.classList.remove('active');
    } else {
        document.getElementById('menu-drawer').classList.remove('open');
        drawer.classList.add('open');
        overlay.classList.add('active');
    }
}

function toggleMenu() {
    const drawer = document.getElementById('menu-drawer');
    const overlay = document.getElementById('overlay');
    
    if (drawer.classList.contains('open')) {
        drawer.classList.remove('open');
        overlay.classList.remove('active');
    } else {
        document.getElementById('cart-drawer').classList.remove('open');
        drawer.classList.add('open');
        overlay.classList.add('active');
    }
}

function closeAllDrawers() {
    document.getElementById('menu-drawer').classList.remove('open');
    document.getElementById('cart-drawer').classList.remove('open');
    document.getElementById('overlay').classList.remove('active');
}

// ------------------------------------------------
// 5. SEARCH LOGIC
// ------------------------------------------------
function handleSearch(query) {
    const term = query.toLowerCase();
    
    if (!term) {
        // Reset to default view
        initializeShop();
        return;
    }

    // Find all matching products
    const matches = products.filter(p => 
        !p.hidden && (
            p.name.toLowerCase().includes(term) || 
            p.category.toLowerCase().includes(term) ||
             (p.tags && p.tags.some(tag => (typeof tag === 'string' ? tag : tag.tag || '').toLowerCase().includes(term))) ||
             (p.description && p.description.toLowerCase().includes(term))
         )
    );

    // Render Search Results (Hi-jack one grid or create a results view)
    // Strategy: Hide all grids, show results in the first one with a title change
    
    // Simplest approach: Filter the existing grids in place? 
    // No, because a search might return items from multiple categories.
    // Better: Clear all grids, and render matches into the first grid (The Exchange) and hide others titles.
    
    document.getElementById('exchange-grid').innerHTML = '';
    document.getElementById('kinetic-grid').innerHTML = '';
    document.getElementById('urban-grid').innerHTML = '';
    
    // Hide headers temporarily (optional, but cleaner)
    document.querySelectorAll('.collection-header').forEach(el => el.style.display = 'none');
    
    // Create a temporary results header if not exists
    let resultsHeader = document.getElementById('search-results-header');
    if (!resultsHeader) {
        resultsHeader = document.createElement('div');
        resultsHeader.id = 'search-results-header';
        resultsHeader.className = 'collection-header';
        resultsHeader.innerHTML = '<h2 class="category-title">Search Results</h2>';
        document.getElementById('exchange-grid').parentNode.insertBefore(resultsHeader, document.getElementById('exchange-grid'));
    }
    resultsHeader.style.display = 'block';

    if (matches.length === 0) {
        document.getElementById('exchange-grid').innerHTML = '<p style="text-align:center; padding:40px;">No products found.</p>';
    } else {
        const container = document.getElementById('exchange-grid');
        matches.forEach(product => {
            // Reuse render logic or copy-paste card creation
            const card = document.createElement('div');
            card.className = 'product-card';
            
            let priceHtml = `₦${product.price.toLocaleString()}`;
            if (product.sale_price) {
                priceHtml = `<span style="text-decoration: line-through; color: #888; font-size: 0.9em; margin-right:5px;">₦${product.price.toLocaleString()}</span> 
                             <span style="color: var(--text-gold);">₦${product.sale_price.toLocaleString()}</span>`;
            }

            card.innerHTML = `
                <div class="p-img-box" onclick="openProductModal(${product.id})">
                    <img src="${product.img}" alt="${product.name}" class="p-img">
                </div>
                <div class="p-info">
                    <h3 class="p-name">${product.name}</h3>
                    <div class="p-price">${priceHtml}</div>
                    <button class="btn-add" onclick="openProductModal(${product.id})">View Options</button>
                </div>
            `;
            container.appendChild(card);
        });
    }
}

// Reset view helper (when search is cleared)
document.getElementById('search-input').addEventListener('input', (e) => {
    if (e.target.value === '') {
        document.querySelectorAll('.collection-header').forEach(el => el.style.display = 'block');
        const resultsHeader = document.getElementById('search-results-header');
        if (resultsHeader) resultsHeader.style.display = 'none';
        initializeShop();
    }
});


// ------------------------------------------------
// 6. UTILITIES (Toast, Checkout)
// ------------------------------------------------
function showToast(message) {
    const toast = document.getElementById("toast");
    if (!toast) return;
    toast.innerText = message;
    toast.className = "toast show";
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

function checkout() {
    if (cart.length === 0) {
        showToast("Your bag is empty.");
        return;
    }
    let totalAmount = cart.reduce((sum, item) => sum + item.finalPrice, 0);
    let email = prompt("Enter your email for the receipt:");
    if (email) {
        // Simulating Paystack for now
        alert(`Proceeding to payment of ₦${totalAmount.toLocaleString()} for ${email}`);
        // In real integration: PaystackPop.setup({...}).openIframe();
    }
}

// ------------------------------------------------
// INITIALIZATION
// ------------------------------------------------
document.addEventListener('DOMContentLoaded', () => {
    fetchProducts();
    
    // Initialize Netlify Identity if present
    // (Disabled for GitHub Pages compatibility)
    // if (window.netlifyIdentity) { ... }
});
    </script>
</body>
</html>
